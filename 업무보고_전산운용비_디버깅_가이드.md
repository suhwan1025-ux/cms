# 업무보고 전산운용비 표시 디버깅 가이드

## 📋 문제 상황
업무보고 메뉴의 상세계약목록에서 전산운용비 기반 품의서의 사업예산란이 비어있음

## 🔍 원인 분석
전산운용비 기반의 **결재완료(approved)** 품의서가 없거나, 서버 코드가 업데이트되지 않았을 가능성

## ✅ 해결 방법

### 1단계: 서버 재시작
수정된 `server.js` 코드를 적용하기 위해 **반드시 서버를 재시작**해야 합니다.

```bash
# 현재 실행 중인 서버 종료 (Ctrl + C)
# 그 다음 재시작
npm start
```

### 2단계: 테스트 데이터 확인
전산운용비 기반의 **결재완료** 품의서가 있는지 확인:

```sql
SELECT id, title, status, budget_id, operating_budget_id, approval_date 
FROM proposals 
WHERE operating_budget_id IS NOT NULL 
  AND status = 'approved' 
ORDER BY id DESC 
LIMIT 5;
```

**없으면**: 157번 품의서를 테스트용으로 사용했습니다 (operating_budget_id = 1, status = approved)

### 3단계: 서버 로그 확인
업무보고 메뉴를 열고 상세계약목록을 조회할 때, **서버 콘솔에 다음과 같은 로그**가 출력됩니다:

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 [업무보고] 예산 정보 조회
   자본예산 IDs: [ 4, 5, ... ]
   전산운용비 IDs: [ 1 ]  ← 전산운용비 품의서가 있으면 여기 표시
   자본예산 조회 결과: 2 개
   전산운용비 조회 결과: 1 개  ← operating_budgets에서 조회 성공
   BudgetMap 키: [ 'capital_4', 'capital_5', 'operating_1' ]  ← operating_1 있어야 함
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[품의서 157] budgetId:null | operatingBudgetId:1
  budgetKey: operating_1
  budget 찾음: O | budgetName: 전산임차료  ← 이렇게 나와야 정상
```

### 4단계: 문제 진단

#### Case 1: `전산운용비 IDs: []` (빈 배열)
→ **결재완료된 전산운용비 품의서가 없습니다**
- 품의서 작성 화면에서 전산운용비 예산을 선택하고 **작성완료**
- 품의서 조회 화면에서 해당 품의서를 열고 **상태변경 → 결재완료**

#### Case 2: `전산운용비 조회 결과: 0 개`
→ **operating_budgets 테이블에 해당 ID의 예산이 없습니다**
```sql
-- operating_budgets 확인
SELECT * FROM operating_budgets WHERE id = 1;
```

#### Case 3: `budget 찾음: X`
→ **budgetMap에 키가 잘못 저장되었습니다**
- `BudgetMap 키`에 `operating_1`이 포함되어 있는지 확인
- 없으면 server.js 5092-5145 라인 코드 재확인

#### Case 4: 로그는 정상인데 화면에 안 나옴
→ **프론트엔드 코드 문제**
- `WorkReport.js` 304라인 확인
- 브라우저 캐시 삭제 후 새로고침 (Ctrl + Shift + R)

## 📝 수정된 파일들
1. **server.js** (5092-5155라인)
   - 전산운용비 예산 조회 로직 추가
   - budgetMap에 'operating_' 접두사로 저장
   - 디버깅 로그 추가

2. **WorkReport.js** (304라인)
   - budgetType을 title 속성으로 표시

## 🧪 테스트 방법
1. 서버 재시작 ✅
2. 브라우저에서 업무보고 메뉴 열기
3. 기간 선택 후 상세계약목록 조회
4. **서버 콘솔 로그 확인** (위 로그 참조)
5. 157번 품의서의 사업예산란에 "전산임차료" 표시되는지 확인

## 🔧 현재 테스트 데이터
- **157번 품의서**: operating_budget_id = 1, status = approved
- **전산임차료 예산**: id = 1, fiscal_year = 2025, budget_amount = 3,190,000,000원

## 💡 추가 확인사항
```sql
-- 전산운용비 품의서 목록
SELECT id, title, status, operating_budget_id, approval_date 
FROM proposals 
WHERE operating_budget_id IS NOT NULL;

-- operating_budgets 전체 목록
SELECT id, fiscal_year, account_subject, budget_amount 
FROM operating_budgets 
ORDER BY id;
```

---
**작성일**: 2025-11-26
**수정 파일**: server.js, WorkReport.js

