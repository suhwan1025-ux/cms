# 운영 환경 정정 기능 배포 - 간단 가이드

## 🚀 빠른 배포 (3단계)

### 1️⃣ 운영 서버 접속 후 코드 업데이트
```bash
cd /path/to/CMS_NEW
git pull origin main
```

### 2️⃣ 마이그레이션 실행 (DB 컬럼 추가)
```bash
# 방법 A: 자동 스크립트 (권장)
NODE_ENV=production node scripts/migrate-production-correction.js

# 또는 방법 B: Sequelize CLI
NODE_ENV=production npx sequelize-cli db:migrate
```

### 3️⃣ 서버 재시작
```bash
# PM2 사용 시
pm2 restart server

# 또는 systemd 사용 시
sudo systemctl restart cms-server
```

---

## ✅ 배포 확인

### 상태 체크 스크립트 실행
```bash
NODE_ENV=production node scripts/check-production-correction.js
```

### 예상 결과
```
✅ original_proposal_id 컬럼 존재
✅ correction_reason 컬럼 존재
✅ 모든 필수 컬럼이 존재합니다!
```

---

## 🧪 기능 테스트

1. **운영 환경 웹 접속**
2. **기존 품의서 선택 → "정정" 버튼 클릭**
3. **정정 사유 입력 후 작성완료**
4. **DB에서 확인:**
   ```sql
   SELECT id, title, original_proposal_id, correction_reason 
   FROM proposals 
   ORDER BY id DESC 
   LIMIT 5;
   ```

---

## ❌ 문제 발생 시

### "컬럼이 없습니다" 에러
→ 마이그레이션 재실행:
```bash
NODE_ENV=production node scripts/migrate-production-correction.js
```

### "변경사항이 반영 안 됨"
→ 프론트엔드 재빌드 + 캐시 삭제:
```bash
npm run build
# 브라우저에서 Ctrl+Shift+R (강력 새로고침)
```

### 서버 로그 확인
```bash
pm2 logs server --lines 100
```

---

## 📞 문제 지속 시 체크할 것

1. ✅ DB에 컬럼이 있는가? → `check-production-correction.js` 실행
2. ✅ 서버 코드가 최신인가? → `git log -1` 확인
3. ✅ 서버가 재시작되었는가? → `pm2 list` 확인
4. ✅ 서버 로그에 "정정 관련 필드 확인" 로그가 보이는가?
5. ✅ 브라우저 콘솔에 "디버깅 - 정정 모드: true" 로그가 보이는가?

